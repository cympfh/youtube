#!/usr/bin/env coffee

url = process.argv[2]

if not url
  console.warn "usage: #{process.argv[1]} url"
  process.exit 0

id =
  url.replace /^.*\//, ''
    .replace /^.*=/, ''
    .replace /&.*$/, ''

kwds = [
  '第三者通報が複数寄せられたため削除'
  'から著作権侵害の申し立てがあったため削除されました'
  'This video is unavailable'
  'アカウントが停止されたため'
  'この動画は存在しません'
]

{exec} = require 'child_process'
fs = require 'fs'

exec "curl -s https://www.youtube.com/watch?v=#{id} > /tmp/html", (er, out) ->
  throw er if er
  fs.readFile '/tmp/html', 'utf8', (er, out) ->
    throw er if er
    bl = kwds.some (kwd) -> (out.indexOf kwd) isnt -1
    if bl
      process.exit 1

# vim: set ft=coffee:
